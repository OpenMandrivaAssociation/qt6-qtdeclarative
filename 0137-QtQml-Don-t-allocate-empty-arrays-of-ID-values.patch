From f4909c51c07933cf7c0016c3086ce515b94f0a7a Mon Sep 17 00:00:00 2001
From: Ulf Hermann <ulf.hermann@qt.io>
Date: Wed, 8 Oct 2025 10:52:12 +0200
Subject: [PATCH 137/239] QtQml: Don't allocate empty arrays of ID values
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Those are unusable anyway.

Task-number: QTBUG-138918
Change-Id: Ie7b381492d8b42b38c4a29e59d74d76058922318
Reviewed-by: Fabian Kosmale <fabian.kosmale@qt.io>
Reviewed-by: Olivier De Canni√®re <olivier.decanniere@qt.io>
(cherry picked from commit 4bf693884e800b85350c2c8d10269a4d4d7a1da6)
Reviewed-by: Qt Cherry-pick Bot <cherrypick_bot@qt-project.org>
---
 src/qml/qml/qqmlcontextdata.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/qml/qml/qqmlcontextdata.cpp b/src/qml/qml/qqmlcontextdata.cpp
index 23cac56959..25723e4ed9 100644
--- a/src/qml/qml/qqmlcontextdata.cpp
+++ b/src/qml/qml/qqmlcontextdata.cpp
@@ -329,7 +329,8 @@ void QQmlContextData::initFromTypeCompilationUnit(const QQmlRefPointer<QV4::Exec
     Q_ASSERT(!m_idValues);
     m_idValueCount = m_typeCompilationUnit->objectAt(m_componentObjectIndex)
             ->nNamedObjectsInComponent;
-    m_idValues = new ContextGuard[m_idValueCount];
+    if (m_idValueCount > 0)
+        m_idValues = new ContextGuard[m_idValueCount];
 }
 
 void QQmlContextData::addComponentAttached(QQmlComponentAttached *attached)
-- 
2.51.2

